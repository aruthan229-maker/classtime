<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ClassTime AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:system-ui,Inter;
  background:#020617;
  color:#e5e7eb;
}
header{
  padding:14px;
  background:#0b1020;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
button{
  background:#8b5cf6;
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:10px;
}
.card{
  margin:12px;
  padding:12px;
  background:#0b1020;
  border-radius:12px;
}
input,select{
  width:100%;
  padding:8px;
  margin-top:6px;
  border-radius:8px;
  border:none;
}
</style>
</head>

<body>

<header>
  <b>ðŸ“… ClassTime AI</b>
</header>

<div class="card">
  <h4>ðŸ”” Notifications</h4>

  <label>
    <input type="checkbox" id="notify"> Enable notifications
  </label><br><br>

  <label>
    Reminder time
    <select id="notifyTime">
      <option value="5">5 minutes</option>
      <option value="10">10 minutes</option>
      <option value="15">15 minutes</option>
    </select>
  </label><br><br>

  <button onclick="testNotification()">ðŸ”” Test Notification</button>
</div>

<div class="card">
  <h4>âž• Add Sample Class</h4>
  <input id="className" placeholder="Class name" value="Maths">
  <input id="classTime" type="time">
  <button onclick="scheduleClass()">Save & Schedule</button>
</div>

<script>
/* ================================
   SAVE SETTINGS
================================ */
const notify = document.getElementById("notify");
const notifyTime = document.getElementById("notifyTime");

notify.checked = localStorage.notify === "true";
notifyTime.value = localStorage.notifyTime || "5";

notify.onchange = () => localStorage.notify = notify.checked;
notifyTime.onchange = () => localStorage.notifyTime = notifyTime.value;

/* ================================
   CAPACITOR SAFE ACCESS
================================ */
function isCapacitor(){
  return window.Capacitor && Capacitor.Plugins;
}

/* ================================
   REQUEST PERMISSION (ON APP LOAD)
================================ */
document.addEventListener("DOMContentLoaded", async () => {
  if(isCapacitor()){
    await Capacitor.Plugins.LocalNotifications.requestPermissions();
  }
});

/* ================================
   TEST NOTIFICATION
================================ */
async function testNotification(){

  if(!notify.checked){
    alert("Notifications disabled âŒ");
    return;
  }

  if(!isCapacitor()){
    alert("Background notifications work only in Android APK");
    return;
  }

  await Capacitor.Plugins.LocalNotifications.schedule({
    notifications: [{
      id: Date.now(),
      title: "ðŸ“… ClassTime AI",
      body: "This is a test notification",
      schedule: { at: new Date(Date.now() + 5000) },
      sound: "default"
    }]
  });

  alert("Test notification scheduled (5 sec)");
}

/* ================================
   SCHEDULE CLASS NOTIFICATION
================================ */
async function scheduleClass(){

  if(!notify.checked){
    alert("Enable notifications first");
    return;
  }

  if(!isCapacitor()){
    alert("This works only in APK");
    return;
  }

  const name = className.value;
  const time = classTime.value;

  if(!time){
    alert("Select class time");
    return;
  }

  const now = new Date();
  let classDate = new Date(
    now.getFullYear(),
    now.getMonth(),
    now.getDate(),
    time.split(":")[0],
    time.split(":")[1]
  );

  const mins = parseInt(notifyTime.value);
  classDate.setMinutes(classDate.getMinutes() - mins);

  await Capacitor.Plugins.LocalNotifications.schedule({
    notifications: [{
      id: Date.now(),
      title: "ðŸ“˜ Upcoming Class",
      body: `${name} starts in ${mins} minutes`,
      schedule: { at: classDate },
      sound: "default"
    }]
  });

  alert("Class notification scheduled âœ…");
}

/* ================================
   OPEN APP WHEN NOTIFICATION TAPPED
================================ */
if(isCapacitor()){
  Capacitor.Plugins.LocalNotifications.addListener(
    "localNotificationActionPerformed",
    () => {
      console.log("Notification tapped â†’ app opened");
    }
  );
}
</script>

</body>
</html>
